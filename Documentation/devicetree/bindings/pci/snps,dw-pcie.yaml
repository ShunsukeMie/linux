# SPDX-License-Identifier: GPL-2.0
%YAML 1.2
---
$id: http://devicetree.org/schemas/pci/snps,dw-pcie.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Synopsys DesignWare PCIe interface

maintainers:
  - Jingoo Han <jingoohan1@gmail.com>
  - Gustavo Pimentel <gustavo.pimentel@synopsys.com>

description: |
  Synopsys DesignWare PCIe host controller

# Please create a separate DT-schema for the particular DWC PCIe Root Port
# controller and make sure it's assigned with the vendor-specific
# compatible string together with the generic Synopsys DWC PCIe strings so
# the bindings would be evaluated against that schema.
select: false

allOf:
  - $ref: /schemas/pci/pci-bus.yaml#
  - $ref: /schemas/pci/snps,dw-pcie-common.yaml#

properties:
  compatible:
    anyOf:
      - description:
          DWC PCIe Root Port controller (IP-core version is explicitly
          specified in the additional compatible string)
        contains:
          allOf:
            - pattern: '^snps,dw-pcie-[0-9]+\.[0-9]+a?$'
            - const: snps,dw-pcie
      - description:
          DWC PCIe Root Port controller (IP-core version is either unknown
          or can be read from the PCIe version register of the PL reg-space)
        contains:
          const: snps,dw-pcie

  reg:
    description:
      At least DBI reg-space and peripheral devices CFG-space outbound window
      are required for the normal controller work. iATU memory IO region is
      also required if the space is unrolled (IP-core version >= 4.80a).
    minItems: 2
    maxItems: 5

  reg-names:
    minItems: 2
    maxItems: 5
    items:
      anyOf:
        - $ref: /schemas/pci/snps,dw-pcie-common.yaml#/definitions/reg-names
        - $ref: '#/definitions/reg-names'
    allOf:
      - contains:
          const: dbi
      - contains:
          const: config

  interrupts:
    description:
      At least MSI interrupt signal is supposed to be specified for
      the DWC PCIe host controller.
    minItems: 1
    maxItems: 26

  interrupt-names:
    minItems: 1
    maxItems: 26
    items:
      anyOf:
        - $ref: /schemas/pci/snps,dw-pcie-common.yaml#/definitions/interrupt-names
        - $ref: '#/definitions/interrupt-names'
    allOf:
      - contains:
          const: msi

  clocks: true

additionalProperties: true

required:
  - compatible
  - reg
  - reg-names

definitions:
  reg-names:
    description:
      DWC PCIe Root Port/Complex specific CSR space names.
    oneOf:
      - description:
          Outbound iATU-capable memory-region which will be used to access
          the peripheral PCIe devices configuration space.
        const: config

  interrupt-names:
    description:
      DWC PCIe Root Port/Complex specific IRQ signal names.
    oneOf:
      - description:
          DSP AXI MSI Interrupt detected. It gets de-asserted when there is
          no more MSI interrupt pending. The interrupt is relevant to the
          iMSI-RX - Integrated MSI Receiver (AXI bridge).
        const: msi
      - description:
          Legacy A/B/C/D interrupt signal. Basically it's triggered by
          receiving a Assert_INT{A,B,C,D}/Desassert_INT{A,B,C,D} message
          from the downstream device.
        pattern: "^int(a|b|c|d)$"
      - description:
          Error condition detected and a bit is set in the Root Error Status
          register of the AER capability. It's asserted when the RC
          internally generated an error or an error message is received by
          the RC.
        const: aer
      - description:
          PME message is received by the port. That means having the PME
          status bit set in the Root Status register (the event is
          supposed to be unmasked in the Root Control register).
        const: pme
      - description:
          Hot-plug event is detected. That is a bit has been set in the
          Slot Status register and the corresponding event is enabled in
          the Slot Control register.
        const: hp
      - description:
          Link Autonomous Bandwidth Status flag has been set in the Link
          Status register (the event is supposed to be unmasked in the
          Link Control register).
        const: bw_au
      - description:
          Bandwidth Management Status flag has been set in the Link
          Status register (the event is supposed to be unmasked in the
          Link Control register).
        const: bw_mg

examples:
  - |
    pcie@dfc00000 {
      compatible = "vendor,soc-pcie", "snps,dw-pcie";
      device_type = "pci";
      reg = <0xdfc00000 0x0001000>, /* IP registers */
            <0xd0000000 0x0002000>; /* Configuration space */
      reg-names = "dbi", "config";
      #address-cells = <3>;
      #size-cells = <2>;
      ranges = <0x81000000 0 0x00000000 0xde000000 0 0x00010000>,
               <0x82000000 0 0xd0400000 0xd0400000 0 0x0d000000>;
      bus-range = <0x0 0xff>;

      interrupts = <25>, <24>;
      interrupt-names = "msi", "hp";
      #interrupt-cells = <1>;

      reset-gpios = <&port0 0 1>;

      phys = <&pcie_phy>;
      phy-names = "pcie";

      num-lanes = <1>;
      max-link-speed = <3>;
    };
